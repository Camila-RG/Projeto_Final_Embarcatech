#include "matriz_leds.h"

PIO pio = pio0;
uint sm = 0;
uint led_r = 0;
uint led_g = 0;
uint led_b = 200;

// Função para definir a cor de um pixel específico
void set_pixel_color(uint32_t *pixels, int index, uint32_t color) {
    if (index >= 0 && index < NUM_PIXELS) {
        pixels[index] = color;
    }
}

// Função para exibir um frame da animação na matriz WS2812
void show_frame(const uint32_t frame[25]) {
    for (int row = 4; row >= 0; row--) {  // Inverte a ordem das linhas
        for (int col = 0; col < 5; col++) {
            int index = row * 5 + col;
            uint32_t color = frame[index];

            // Converte de RGB para GRB
            uint8_t r = (color >> 16) & 0xFF;
            uint8_t g = (color >> 8) & 0xFF;
            uint8_t b = color & 0xFF;
            uint32_t corrected_color = (g << 16) | (r << 8) | b;

            pio_sm_put_blocking(pio, sm, corrected_color);
        }
    }
}


// Função para percorrer os frames da animação e exibir na matriz de LEDs
void show_animation(const uint32_t animation[][25], int frame_count, int delay_ms) {
    for (int i = 0; i < frame_count; i++) {
        show_frame(animation[i]);
        sleep_ms(delay_ms);
    }
}

// Função para exibir uma cor sólida na matriz de LEDs
void display_static_color(uint32_t color) {
    for (int i = 0; i < NUM_PIXELS; i++) {
        pio_sm_put_blocking(pio, sm, color);
    }
}

// Exemplo de chamada
void run_visual_mode() {
    static const uint32_t anim3[18][25] = {
        {
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317
            },
            {
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff713317, 0xff713317, 0xff713317, 0xff713317
            },
            {
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff1ec6cf, 0xff713317, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff713317, 0xff713317, 0xff713317
            },
            {
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff1ec6cf, 0xff713317, 0xff713317, 
            0xff713317, 0xff1ec6cf, 0xff1ec6cf, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff713317, 0xff713317
            },
            {
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff1ec6cf, 0xff713317, 
            0xff713317, 0xff713317, 0xff1ec6cf, 0xff1ec6cf, 0xff713317, 
            0xff713317, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff713317
            },
            {
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff1ec6cf, 
            0xff713317, 0xff713317, 0xff713317, 0xff1ec6cf, 0xff1ec6cf, 
            0xff713317, 0xff713317, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff713317, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf
            },
            {
            0xff713317, 0xff713317, 0xff713317, 0xff1ec6cf, 0xff1ec6cf, 
            0xff713317, 0xff713317, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff713317, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf
            },
            {
            0xff713317, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf
            },
            {
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf
            },
            {
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf
            },
            {
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf
            },
            {
            0xff1ec6cf, 0xff1ec6cf, 0xff713317, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf
            },
            {
            0xff1ec6cf, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff713317, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf
            },
            {
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff713317, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff713317
            },
            {
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff713317, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff1ec6cf, 0xff713317, 0xff713317
            },
            {
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff1ec6cf, 0xff713317, 0xff713317, 0xff713317
            },
            {
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff1ec6cf, 0xff713317, 0xff713317, 0xff713317, 0xff713317
            },
            {
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317, 
            0xff713317, 0xff713317, 0xff713317, 0xff713317, 0xff713317
            }
        };
    show_animation(anim3, 4, 200);
}
